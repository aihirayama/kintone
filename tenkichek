var countStart_FaxNo= Sheet_1.getRange('D1').getValue()

function transcription () {
    
    if(last < 2){
    Browser.msgBox('ç¯„å›²ãŒã‚ã‚Šã¾ã›ã‚“ğŸ˜¿') 
    return
  }

  //è¡¨ç¤ºå½¢å¼ã‚’ã€Œæ›¸å¼ãªã—ãƒ†ã‚­ã‚¹ãƒˆã€ã«è¨­å®š
  Sheet_1.getRange('A:L').setNumberFormat('@'); 
  
  //å€¤ã‚’1ãƒ¬ã‚³ãƒ¼ãƒ‰ãšã¤åˆ†å‰²ã—ã¦ã„ã
  var records = [];
  var array = Array.prototype.concat.apply([],values);//ã‚·ãƒ¼ãƒˆã®å€¤ã‚’ä¸€æ¬¡å…ƒé…åˆ—ã«ã™ã‚‹
  
  for(var i = 0; 0 < array.length; i++){
    if(array.indexOf('è»¢è¨˜æ¸ˆã¿') === 36){
      records.push(array.splice(0,48)) 
    }else {
      records.push(array.splice(0,36)) 
    }
  }
  
  //å†…å®¹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹é–¢æ•°
  //'Id': 0,'é¡§å®¢å': 1,'éƒµä¾¿ç•ªå·': 2,'ä½æ‰€': 3,'Tel': 4,'æ‹…å½“è€…': 5,'ç™»éŒ²è€…': 6,'æ‹…å½“ã‚ªãƒš': 7,'å†…å®¹': 8,'CSå¯¾å¿œçŠ¶æ³': 9,'å‚™è€ƒ': 10,'ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚³ãƒ¼ãƒ‰': 11,'FAXNo': 12,'Faxâ€™ï¼š16,'å—ä¿¡æ—¥æ™‚': 24,'Email': 28,'è»¢è¨˜æ¸ˆ': 36
  function tag(i,item) {
    var st = {
      //é …ç›®ï¼šã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç•ªå·
      'Id': records[i][0],
      'FAXNo': records[i][12],
      'å—ä¿¡æ—¥æ™‚': records[i][24],
      'é¡§å®¢å': records[i][1],
      'éƒµä¾¿ç•ªå·': records[i][2],
      'ä½æ‰€': records[i][3],
      'Tel': records[i][4],
      'Fax' : records[i][16],
      'Email':records[i][28],
      'æ‹…å½“è€…': records[i][5],
      'ç™»éŒ²è€…': records[i][6],
      'æ‹…å½“ã‚ªãƒš': records[i][7],
      'å†…å®¹': records[i][8],
      'CSå¯¾å¿œçŠ¶æ³': records[i][9],
      'å‚™è€ƒ': records[i][10],
      'ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚³ãƒ¼ãƒ‰': records[i][11],
      'è»¢è¨˜æ¸ˆã¿': records[i][36],
    }
    return st[item]
  }
  
  //è»¢è¨˜æŠœã‘ã¨ä¸è¦ãªè»¢è¨˜ã®ãƒã‚§ãƒƒã‚¯
  var messagebox = '';
  var message_n = '';
  var message_f = '';
  
  for(a in records){
    
    //è»¢è¨˜æŠœã‘check  
    if(records[a].length < 39 && tag(a,'å‚™è€ƒ').search(/.*ã€è»¢è¨˜ãªã—ã€‘*/) < 0){  
      message_n += 'ãƒ»' + tag(a,'å—ä¿¡æ—¥æ™‚') + '\\nã€€' + tag(a,'FAXNo') + tag(a,'é¡§å®¢å') + '\\n';
    } 
    
    //ä¸è¦ãªè»¢è¨˜check
    if(records[a].length > 39 && tag(a,'å‚™è€ƒ').search(/.*ã€è»¢è¨˜ãªã—ã€‘*/) > -1){  
      message_f += 'ãƒ»' + tag(a,'å—ä¿¡æ—¥æ™‚') + '\\nã€€' + ' ' + tag(a,'FAXNo') + tag(a,'é¡§å®¢å') + '\\n';
    }  
  }
  
  if(message_n.length > 0){messagebox += '------ã€è»¢è¨˜æŠœã‘ã€‘ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“-------\\n' + message_n + '\\n\\n\\n';}
  if(message_f.length > 0){messagebox += '------ã€ä¸è¦ãªè»¢è¨˜ã€‘ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“------\\n ' + message_f;}
  
  if(messagebox.length > 0){
    Browser.msgBox(messagebox) 
    return
  }
  
  var count_date = [];
  //è»¢è¨˜æ•°ã‚’æ•°ãˆã‚‹  
  for(j in records){
    if(tag(j,'è»¢è¨˜æ¸ˆã¿') === 'è»¢è¨˜æ¸ˆã¿'){  
      count_date.push(new Date(tag(j,'å—ä¿¡æ—¥æ™‚')))
    }    
    if(tag(j,'FAXNo') === countStart_FaxNo){
      break;
    }  
  }  
  
  //è»¢è¨˜ã—ãŸFAXã®ä¸­ã«åœŸæ›œæ—¥ãŒã‚ã‚‹ã‹ç¢ºèªã™ã‚‹ã€‚
  var sat_count = 0;
  for(var i = 0; i < count_date.length; i++){
    if(count_date[i].getDay() === 6){      
      sat_count++;
      break;
    }
  }
  
  //è»¢è¨˜ã—ãŸFAXã®ä¸­ã«ä»Šæ—¥ã®æ—¥ä»˜ã§å—ä¿¡æ™‚é–“ãŒ10æ™‚ã‚ˆã‚Šå‰ã®FAXãŒã‚ã‚‹ã‹ç¢ºèªã™ã‚‹ã€‚
  var h_count = 0;
  for(var i = 0; i < count_date.length; i++){
    if(count_date[i].getFullYear() === new Date().getFullYear() && count_date[i].getMonth() === new Date().getMonth() && count_date[i].getDate() === new Date().getDate() && count_date[i].getHours() < 10){
      h_count++;
      break;
    }
  }
  
  
  //ğŸŒ»ğŸ° â†“è¡¨ç¤ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚’å¤‰ãˆãŸã„å ´åˆã¯ã“ã¡ã‚‰ã‚’ç·¨é›† ğŸ®ğŸŒ»
  var postingSheet_Mg1 = 'æ¡ˆå†…ï¼šè»¢è¨˜æŠœã‘ã¯è¦‹å½“ãŸã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚\\n\\n' + 'â€»â€»NGFAXã«æœªè»¢è¨˜FAXãŒæ··ã–ã£ã¦ã„ãªã„ã‹ç¢ºèªã™ã‚‹â€»â€»\\nâ€»â€»ãƒ”ãƒ³ã‚¯ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã«ã€Œæ—¢å­˜?ã€ãŒå…¥ã£ã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹â€»â€»\\n\\n'
  
  //å—ä¿¡æ—¥æ™‚(æ™‚é–“åˆ¤å®šã«ä½¿ã†)
  var Upper_date = count_date[0];//ä¸€ç•ªä¸Šã®è»¢è¨˜
  var Lower_date = count_date[count_date.length-1];//ä¸€ç•ªä¸‹ã®è»¢è¨˜
  //è»¢è¨˜ç¯„å›²ã®æ—¥ä»˜  
  var period = count_date[count_date.length-1].toLocaleString().slice(0,19) + ' ï½ ' + count_date[0].toLocaleString().slice(0,19);
  
  //ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³å…ˆ
  //é€šå¸¸æ™‚è»¢è¨˜ãƒ¡ãƒ³ãƒãƒ¼
  var tenkimember = '@hiroshi.shimoyamada @chikoto.mizushima @rie.endo @shiori.tsuchiya @sara.oda'.replace(channel_name, "" );//è‡ªåˆ†ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯å®›åã‹ã‚‰å‰Šé™¤
  //æœã ã‘ã®ãƒ¡ãƒ³ãƒãƒ¼
  var asa_tenkimember =ã€€tenkimember + '@yumi.sakai @yuka.yamaguchi'.replace(channel_name, "" );//è‡ªåˆ†ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯å®›åã‹ã‚‰å‰Šé™¤
  //CCãƒ¡ãƒ³ãƒãƒ¼
  var ccmember =ã€€'cc @ai.hirayama @sayaka.komuro @rino.narita'.replace(channel_name, "" );//è‡ªåˆ†ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯å®›åã‹ã‚‰å‰Šé™¤
  
  //è¡¨ç¤ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸-----------------
  //è»¢è¨˜ãŒç„¡ã‹ã£ãŸæ™‚(ã“ã®ãƒ—ãƒ©ã‚°ãƒ©ãƒ ã‚’èµ°ã‚‰ã›ãŸæ™‚é–“å¸¯ã‚’è¡¨ç¤º)
  if(countStart_FaxNo === ''){
    postingSheet_Mg1 += '--------ğŸ™…è»¢è¨˜ã—ãªã‹ã£ãŸã¨ãğŸ™…--------\\n\\n'
    + tenkimember + '\\n'
    + ccmember + '\\n'
    + new Date().getHours() + 'æ™‚å—ä¿¡åˆ†ã¾ã§ã®FAXç®¡ç†ãŒå®Œäº†è‡´ã—ã¾ã—ãŸãŒã€è¦‹è¾¼è»¢è¨˜0ä»¶ã§ã—ãŸã®ã§å¿µã®ãŸã‚ã”é€£çµ¡ã§ã™ã€‚\\n ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚'
    
    //è»¢è¨˜ã—ãŸFAXã®ä¸­ã§ä¸€ç•ªä¸‹ã®FAXã®å—ä¿¡æ—¥æ™‚ãŒé‡‘æ›œæ—¥ã®16:30ä»¥é™ or è»¢è¨˜ã—ãŸFAXã®ä¸­ã«åœŸæ›œæ—¥å—ä¿¡åˆ†ãŒå…¥ã£ã¦ã„ã‚‹ã€‚
  } else if(Lower_date.getDay() === 5 && Lower_date.getDay() >= 16 && Lower_date.getMinutes() >= 30 || Lower_date.getDay() === 5 && Lower_date.getDay() >= 17 || sat_count){
    var date = new Date(Lower_date.setDate(Lower_date.getDate() + (6 - Lower_date.getDay())));  
    postingSheet_Mg1 += '--------ğŸŒ…åœŸæ›œæ—¥ã¾ã§ã®è»¢è¨˜(ã¤Ï‰ï½€)--------\\n\\n'
    + asa_tenkimember + '\\n'
    + ccmember  + '\\n'
    + (date.getMonth()+1) + '/' + date.getDate() + '(åœŸ) ã¾ã§ã®FAXç®¡ç†å®Œäº†ã—ã¾ã—ãŸã€‚' + count_date.length + 'ä»¶è¦‹è¾¼ã¿è»¢è¨˜ã—ã¾ã—ãŸã®ã§æŒ¯ã‚Šåˆ†ã‘ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚ \\nï¼ˆ' 
    + period + ' )';
    
    //è»¢è¨˜ã—ãŸFAXã®ä¸­ã«ä»Šæ—¥ã®æ—¥ä»˜ã§å—ä¿¡æ™‚é–“ãŒ10:00ã‚ˆã‚Šå‰ã®FAXãŒã‚ã‚‹ or è»¢è¨˜ã—ãŸFAXã®ä¸­ã§ä¸€ç•ªä¸‹ã®FAXã®å—ä¿¡æ›œæ—¥ãŒä»Šæ—¥ã‚ˆã‚Šå‰ã€‚
  } else if( h_count || Lower_date.getDay() < new Date().getDay()){ 
    postingSheet_Mg1 += '--------ğŸŒ„10æ™‚ã®è»¢è¨˜(ã¤Ğ”ï½€)--------\\n\\n'
    + asa_tenkimember + '\\n'
    + ccmember + '\\n'
    + (Upper_date.getMonth()+1) + '/' + Upper_date.getDate() + ' 10:00ã¾ã§ã®FAXç®¡ç†å®Œäº†ã—ã¾ã—ãŸã€‚' + count_date.length + 'ä»¶è¦‹è¾¼ã¿è»¢è¨˜ã—ã¾ã—ãŸã®ã§æŒ¯ã‚Šåˆ†ã‘ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚ \\nï¼ˆ' 
    + period + ' )';
    
    //ã“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’èµ°ã‚‰ã›ãŸæ™‚é–“ãŒ16:30ä»¥é™
  } else if(new Date().getHours() >= 16 && new Date().getMinutes() >= 30 || new Date().getHours() >= 17){ 
    postingSheet_Mg1 += '--------ğŸŒ›æœ€å¾Œã®è»¢è¨˜(Ë˜Ï‰Ë˜)--------\\n\\n'
    + tenkimember + '\\n'
    + ccmember + '\\n'
    + count_date.length + 'ä»¶è¦‹è¾¼è»¢è¨˜ã„ãŸã—ã¾ã—ãŸã€‚æŒ¯ã‚Šåˆ†ã‘ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚\\n ã“ã‚Œã§16:30ã¾ã§ã®ç®¡ç†çµ‚äº†ã§ã™ã€‚ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚ \\nï¼ˆ' 
    + period + ' )';
    
    //ä¸Šè¨˜ã®æ¡ä»¶ã«1ã¤ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„
  } else {
    postingSheet_Mg1 += '--------ğŸŒæ—¥ä¸­ã®è»¢è¨˜(ã¤âˆ€-)--------\\n\\n'
    + tenkimember  + '\\n'
    + ccmember  + '\\n'  
    + count_date.length + 'ä»¶è¦‹è¾¼è»¢è¨˜ã„ãŸã—ã¾ã—ãŸã€‚æŒ¯ã‚Šåˆ†ã‘ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚ \\nï¼ˆ' 
    + period + ' )';
  }
  
  Browser.msgBox(postingSheet_Mg1);
  return false;
}
